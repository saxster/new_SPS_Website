---
// Desktop navigation bar with mega menu dropdowns
// Hidden on mobile/tablet - SideDrawer handles mobile navigation
---

<!-- Desktop Navigation Bar - Hidden on mobile -->
<nav
  id="desktop-navbar"
  class="hidden lg:block fixed top-10 left-0 w-full z-[90] bg-neutral-900/95 backdrop-blur-sm border-b-2 border-neutral-800"
  role="navigation"
  aria-label="Main navigation"
>
  <div class="max-w-7xl mx-auto px-6">
    <div class="flex items-center justify-between h-14">
      <!-- Left: Logo + Nav Links -->
      <div class="flex items-center gap-8">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-3 group">
          <img src="/sps-logo.png" alt="" class="w-8 h-auto" width="32" height="32" />
          <span class="text-lg font-black text-primary-accent tracking-tight">SPS</span>
        </a>

        <!-- Navigation Links -->
        <div class="flex items-center gap-1">
          <!-- INTEL Dropdown -->
          <div class="relative" data-dropdown="intel">
            <button
              class="nav-link flex items-center gap-1.5 py-2 px-3 text-sm font-bold uppercase tracking-wider text-neutral-300 hover:text-primary-accent transition-colors"
              aria-expanded="false"
              aria-haspopup="true"
              aria-controls="mega-intel"
            >
              Intel
              <svg class="w-3 h-3 transition-transform dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="square" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
              <span class="ml-1 text-[10px] font-mono text-neutral-600 hidden xl:inline">[I]</span>
            </button>

            <!-- Intel Mega Menu -->
            <div
              id="mega-intel"
              class="mega-menu absolute top-full left-0 mt-0 w-[640px] bg-neutral-900 border-2 border-neutral-700 opacity-0 invisible translate-y-2 transition-all duration-200"
              role="menu"
              aria-label="Intelligence menu"
            >
              <div class="p-6">
                <div class="grid grid-cols-3 gap-8">
                  <!-- Command Center -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Command Center</h3>
                    <ul class="space-y-2">
                      <li><a href="/intelligence" class="mega-link">Global Intelligence</a></li>
                      <li><a href="/intelligence/india-trends" class="mega-link flex items-center gap-2">India Threat Forecast <span class="text-[9px] bg-amber-900/30 text-amber-500 px-1.5 py-0.5 border border-amber-500/30">BETA</span></a></li>
                      <li><a href="/news" class="mega-link flex items-center gap-2">News & Views <span class="w-1.5 h-1.5 bg-primary-accent rounded-full animate-pulse"></span></a></li>
                      <li><a href="/intelligence/tags" class="mega-link">Tags Index</a></li>
                    </ul>
                  </div>

                  <!-- Briefings -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Briefings</h3>
                    <ul class="space-y-2">
                      <li><a href="/articles" class="mega-link">Strategic Briefings</a></li>
                      <li><a href="/articles?type=analysis" class="mega-link">Latest Analysis</a></li>
                      <li><a href="/articles?type=case-study" class="mega-link">Case Studies</a></li>
                    </ul>
                  </div>

                  <!-- Sectors -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Sectors</h3>
                    <ul class="space-y-2">
                      <li><a href="/sectors/residential" class="mega-link">Residential</a></li>
                      <li><a href="/sectors/corporate" class="mega-link">Corporate</a></li>
                      <li><a href="/sectors/healthcare" class="mega-link">Healthcare</a></li>
                      <li><a href="/sectors/logistics" class="mega-link">Logistics</a></li>
                      <li><a href="/#sectors" class="mega-link text-primary-accent">+ All Sectors →</a></li>
                    </ul>
                  </div>
                </div>

                <!-- Featured Card -->
                <div class="mt-6 pt-6 border-t border-neutral-800">
                  <a href="/intelligence" class="block p-4 bg-neutral-800/50 border border-neutral-700 hover:border-primary-accent transition-colors group/card">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-primary-accent/10 border border-primary-accent/30 flex items-center justify-center">
                        <svg class="w-5 h-5 text-primary-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm font-bold text-neutral-200 group-hover/card:text-primary-accent transition-colors">Global Command Center</p>
                        <p class="text-xs text-neutral-500">Real-time security intelligence dashboard</p>
                      </div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- RESOURCES Dropdown -->
          <div class="relative" data-dropdown="resources">
            <button
              class="nav-link flex items-center gap-1.5 py-2 px-3 text-sm font-bold uppercase tracking-wider text-neutral-300 hover:text-primary-accent transition-colors"
              aria-expanded="false"
              aria-haspopup="true"
              aria-controls="mega-resources"
            >
              Resources
              <svg class="w-3 h-3 transition-transform dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="square" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
              <span class="ml-1 text-[10px] font-mono text-neutral-600 hidden xl:inline">[R]</span>
            </button>

            <!-- Resources Mega Menu -->
            <div
              id="mega-resources"
              class="mega-menu absolute top-full left-0 mt-0 w-[560px] bg-neutral-900 border-2 border-neutral-700 opacity-0 invisible translate-y-2 transition-all duration-200"
              role="menu"
              aria-label="Resources menu"
            >
              <div class="p-6">
                <div class="grid grid-cols-3 gap-8">
                  <!-- Tools -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Tools</h3>
                    <ul class="space-y-2">
                      <li><a href="/tools/compliance-calculator" class="mega-link flex items-center gap-2">Compliance Calc <span class="text-[9px] bg-neutral-800 text-neutral-400 px-1.5 py-0.5">V1.0</span></a></li>
                      <li><a href="/tools/risk-calculator" class="mega-link">Risk Calculator</a></li>
                      <li><a href="/tools/storage-calculator" class="mega-link">Storage Calculator</a></li>
                    </ul>
                  </div>

                  <!-- Knowledge -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Knowledge</h3>
                    <ul class="space-y-2">
                      <li><a href="/community/expert-forum" class="mega-link">Expert Q&A Archive</a></li>
                      <li><a href="/resources/templates" class="mega-link">Resource Templates</a></li>
                      <li><a href="/privacy" class="mega-link">Privacy Policy</a></li>
                    </ul>
                  </div>

                  <!-- Community -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Community</h3>
                    <ul class="space-y-2">
                      <li><a href="/community/expert-forum" class="mega-link">Expert Forum</a></li>
                      <li><a href="#ask-expert" class="mega-link" id="nav-ask-expert">Ask SPS AI</a></li>
                    </ul>
                  </div>
                </div>

                <!-- Featured Card -->
                <div class="mt-6 pt-6 border-t border-neutral-800">
                  <a href="/tools/compliance-calculator" class="block p-4 bg-compliance/5 border border-compliance/30 hover:border-compliance transition-colors group/card">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-compliance/10 border border-compliance/30 flex items-center justify-center">
                        <svg class="w-5 h-5 text-compliance" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm font-bold text-neutral-200 group-hover/card:text-compliance transition-colors">Compliance Calculator</p>
                        <p class="text-xs text-neutral-500">Check PSARA & regulatory requirements</p>
                      </div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- OPERATIONS Dropdown -->
          <div class="relative" data-dropdown="operations">
            <button
              class="nav-link flex items-center gap-1.5 py-2 px-3 text-sm font-bold uppercase tracking-wider text-neutral-300 hover:text-primary-accent transition-colors"
              aria-expanded="false"
              aria-haspopup="true"
              aria-controls="mega-operations"
            >
              Operations
              <svg class="w-3 h-3 transition-transform dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="square" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
              <span class="ml-1 text-[10px] font-mono text-neutral-600 hidden xl:inline">[O]</span>
            </button>

            <!-- Operations Mega Menu -->
            <div
              id="mega-operations"
              class="mega-menu absolute top-full left-0 mt-0 w-[320px] bg-neutral-900 border-2 border-neutral-700 opacity-0 invisible translate-y-2 transition-all duration-200"
              role="menu"
              aria-label="Operations menu"
            >
              <div class="p-6">
                <div>
                  <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Case Studies</h3>
                  <ul class="space-y-2">
                    <li><a href="/operations" class="mega-link">Operations Log</a></li>
                    <li><a href="/operations/digital-arrest" class="mega-link">Digital Arrest Scam</a></li>
                    <li><a href="/operations/zaveri-bazaar" class="mega-link">Zaveri Bazaar</a></li>
                    <li><a href="/operations/manesar-strike" class="mega-link">Manesar Strike</a></li>
                  </ul>
                </div>

                <!-- Featured Card -->
                <div class="mt-6 pt-6 border-t border-neutral-800">
                  <a href="/operations" class="block p-4 bg-neutral-800/50 border border-neutral-700 hover:border-primary-accent transition-colors group/card">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-primary-accent/10 border border-primary-accent/30 flex items-center justify-center">
                        <svg class="w-5 h-5 text-primary-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm font-bold text-neutral-200 group-hover/card:text-primary-accent transition-colors">View All Operations</p>
                        <p class="text-xs text-neutral-500">Declassified case files</p>
                      </div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- ABOUT Dropdown -->
          <div class="relative" data-dropdown="about">
            <button
              class="nav-link flex items-center gap-1.5 py-2 px-3 text-sm font-bold uppercase tracking-wider text-neutral-300 hover:text-primary-accent transition-colors"
              aria-expanded="false"
              aria-haspopup="true"
              aria-controls="mega-about"
            >
              About
              <svg class="w-3 h-3 transition-transform dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="square" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
              <span class="ml-1 text-[10px] font-mono text-neutral-600 hidden xl:inline">[A]</span>
            </button>

            <!-- About Mega Menu -->
            <div
              id="mega-about"
              class="mega-menu absolute top-full left-0 mt-0 w-[400px] bg-neutral-900 border-2 border-neutral-700 opacity-0 invisible translate-y-2 transition-all duration-200"
              role="menu"
              aria-label="About menu"
            >
              <div class="p-6">
                <div class="grid grid-cols-2 gap-8">
                  <!-- Company -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Company</h3>
                    <ul class="space-y-2">
                      <li><a href="/about" class="mega-link">About SPS</a></li>
                      <li><a href="/officers" class="mega-link">Command Structure</a></li>
                      <li><a href="/services" class="mega-link">Our Services</a></li>
                    </ul>
                    <div class="mt-4 pt-4 border-t border-neutral-800">
                      <span class="inline-flex items-center gap-2 text-xs font-mono text-compliance">
                        <span class="w-2 h-2 bg-compliance rounded-full"></span>
                        TRUSTED SINCE 1965
                      </span>
                    </div>
                  </div>

                  <!-- Connect -->
                  <div>
                    <h3 class="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-4 border-b border-neutral-800 pb-2">Connect</h3>
                    <ul class="space-y-2">
                      <li><a href="/contact" class="mega-link">Contact</a></li>
                      <li><a href="https://wa.me/919876543210" class="mega-link" target="_blank" rel="noopener">WhatsApp Support</a></li>
                      <li><a href="/newsletter" class="mega-link">Newsletter</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Search -->
      <button
        id="navbar-search-btn"
        class="flex items-center gap-2 py-2 px-3 text-sm text-neutral-400 hover:text-primary-accent border border-neutral-700 hover:border-primary-accent transition-all group"
        aria-label="Search (Cmd+K)"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <span class="hidden sm:inline font-mono text-xs">Search</span>
        <span class="text-[10px] font-mono px-1.5 py-0.5 bg-neutral-800 text-neutral-500 border border-neutral-700 group-hover:border-primary-accent group-hover:text-primary-accent hidden sm:inline">⌘K</span>
      </button>
    </div>
  </div>
</nav>

<style>
  /* Mega menu link styling */
  .mega-link {
    display: block;
    padding: 0.375rem 0;
    font-size: 0.875rem;
    color: #d4d4d4;
    transition: color 0.15s, transform 0.15s;
  }

  .mega-link:hover {
    color: #FF4D00;
    transform: translateX(4px);
  }

  /* Dropdown open state */
  [data-dropdown].open .dropdown-chevron {
    transform: rotate(180deg);
  }

  [data-dropdown].open .nav-link {
    color: #FF4D00;
  }

  .mega-menu.open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
</style>

<script>
  // Navbar dropdown behavior with hover delay
  const dropdowns = document.querySelectorAll('[data-dropdown]');
  const searchBtn = document.getElementById('navbar-search-btn');
  const askExpertLink = document.getElementById('nav-ask-expert');

  let hoverTimeout: ReturnType<typeof setTimeout> | null = null;
  let currentOpenDropdown: Element | null = null;

  function openDropdown(dropdown: Element) {
    // Close any currently open dropdown
    if (currentOpenDropdown && currentOpenDropdown !== dropdown) {
      closeDropdown(currentOpenDropdown);
    }

    const button = dropdown.querySelector('button');
    const menu = dropdown.querySelector('.mega-menu');

    dropdown.classList.add('open');
    button?.setAttribute('aria-expanded', 'true');
    menu?.classList.add('open');
    currentOpenDropdown = dropdown;
  }

  function closeDropdown(dropdown: Element) {
    const button = dropdown.querySelector('button');
    const menu = dropdown.querySelector('.mega-menu');

    dropdown.classList.remove('open');
    button?.setAttribute('aria-expanded', 'false');
    menu?.classList.remove('open');

    if (currentOpenDropdown === dropdown) {
      currentOpenDropdown = null;
    }
  }

  function closeAllDropdowns() {
    dropdowns.forEach(closeDropdown);
    currentOpenDropdown = null;
  }

  // Setup hover and click behavior for each dropdown
  dropdowns.forEach((dropdown) => {
    const button = dropdown.querySelector('button');
    const menu = dropdown.querySelector('.mega-menu');

    // Mouse enter with delay
    dropdown.addEventListener('mouseenter', () => {
      if (hoverTimeout) clearTimeout(hoverTimeout);
      hoverTimeout = setTimeout(() => {
        openDropdown(dropdown);
      }, 150); // 150ms delay to prevent accidental triggers
    });

    // Mouse leave with delay
    dropdown.addEventListener('mouseleave', () => {
      if (hoverTimeout) clearTimeout(hoverTimeout);
      hoverTimeout = setTimeout(() => {
        closeDropdown(dropdown);
      }, 100);
    });

    // Click also opens/closes
    button?.addEventListener('click', (e) => {
      e.preventDefault();
      if (dropdown.classList.contains('open')) {
        closeDropdown(dropdown);
      } else {
        openDropdown(dropdown);
      }
    });

    // Focus management
    button?.addEventListener('focus', () => {
      if (hoverTimeout) clearTimeout(hoverTimeout);
    });

    // Close when clicking a link inside the menu
    const links = menu?.querySelectorAll('a');
    links?.forEach(link => {
      link.addEventListener('click', () => {
        setTimeout(closeAllDropdowns, 100);
      });
    });
  });

  // Close on click outside
  document.addEventListener('click', (e) => {
    const target = e.target as Element;
    if (!target.closest('[data-dropdown]')) {
      closeAllDropdowns();
    }
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    // Don't trigger if user is typing in an input
    if ((e.target as Element).tagName === 'INPUT' ||
        (e.target as Element).tagName === 'TEXTAREA' ||
        (e.target as HTMLElement).isContentEditable) {
      return;
    }

    // Don't trigger with modifier keys (except for Cmd+K)
    const isSearchShortcut = (e.key === 'k' || e.key === 'K') && (e.metaKey || e.ctrlKey);
    const isSlashKey = e.key === '/';

    if (!isSearchShortcut && !isSlashKey && (e.metaKey || e.ctrlKey || e.altKey)) {
      return;
    }

    // Escape closes menus
    if (e.key === 'Escape') {
      closeAllDropdowns();
      return;
    }

    // Search shortcut
    if (isSearchShortcut || isSlashKey) {
      e.preventDefault();
      if ((window as any).openSPSSearch) {
        (window as any).openSPSSearch();
      }
      return;
    }

    // Keyboard shortcuts for navigation
    const keyMap: Record<string, string> = {
      'i': 'intel',
      'I': 'intel',
      'r': 'resources',
      'R': 'resources',
      'o': 'operations',
      'O': 'operations',
      'a': 'about',
      'A': 'about',
    };

    if (keyMap[e.key]) {
      e.preventDefault();
      const targetDropdown = document.querySelector(`[data-dropdown="${keyMap[e.key]}"]`);
      if (targetDropdown) {
        if (targetDropdown.classList.contains('open')) {
          closeDropdown(targetDropdown);
        } else {
          openDropdown(targetDropdown);
          // Focus first link in menu
          const firstLink = targetDropdown.querySelector('.mega-menu a') as HTMLElement;
          firstLink?.focus();
        }
      }
    }
  });

  // Arrow key navigation within menus
  document.addEventListener('keydown', (e) => {
    if (!currentOpenDropdown) return;

    const menu = currentOpenDropdown.querySelector('.mega-menu');
    const links = menu?.querySelectorAll('a') as NodeListOf<HTMLElement>;
    if (!links || links.length === 0) return;

    const currentIndex = Array.from(links).findIndex(link => link === document.activeElement);

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const nextIndex = currentIndex < links.length - 1 ? currentIndex + 1 : 0;
      links[nextIndex].focus();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      const prevIndex = currentIndex > 0 ? currentIndex - 1 : links.length - 1;
      links[prevIndex].focus();
    }
  });

  // Search button click
  searchBtn?.addEventListener('click', () => {
    if ((window as any).openSPSSearch) {
      (window as any).openSPSSearch();
    }
  });

  // Ask Expert link - trigger the widget
  askExpertLink?.addEventListener('click', (e) => {
    e.preventDefault();
    closeAllDropdowns();
    // Trigger the AskExpert widget if it exists
    const askExpertBtn = document.querySelector('[data-ask-expert-trigger]') as HTMLElement;
    askExpertBtn?.click();
  });
</script>
