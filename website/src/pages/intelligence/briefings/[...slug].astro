---
import Layout from '../../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';
import RelatedArticles from '../../../components/RelatedArticles.astro';

export async function getStaticPaths() {
  const briefings = await getCollection('intelligence');
  return briefings.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const severityColors = {
    Critical: 'bg-red-600 text-white',
    High: 'bg-orange-600 text-white',
    Medium: 'bg-yellow-600 text-black',
    Low: 'bg-blue-600 text-white'
};
---

<Layout title={`${entry.data.title} | SPS Strategic Briefing`} description={`Autonomous intelligence analysis of ${entry.data.sector} sector events in India.`}>
    <main class="bg-neutral-950 min-h-screen text-neutral-300 font-sans pb-20">
        
        <!-- Header -->
        <div class="border-b border-neutral-800 bg-neutral-900 pt-32 pb-12 px-6">
            <div class="max-w-4xl mx-auto">
                <a href="/intelligence/briefings" class="text-primary-accent text-xs font-bold uppercase tracking-widest mb-8 inline-block hover:underline">
                    ← Back to all briefings
                </a>
                
                <div class="flex items-center gap-3 mb-6 flex-wrap">
                    <span class={`text-[10px] font-black px-2 py-1 rounded uppercase tracking-widest ${severityColors[entry.data.severity]}`}>
                        {entry.data.severity} SEVERITY
                    </span>
                    <span class="text-neutral-500 text-sm font-mono">/ {entry.data.sector} / {entry.data.pubDate.toLocaleDateString('en-IN')}</span>
                </div>

                <h1 class="text-4xl md:text-5xl font-black text-white tracking-tight mb-8 leading-tight">
                    {entry.data.title}
                </h1>

                <div class="flex flex-wrap gap-8 py-6 border-y border-neutral-800">
                    <div class="flex flex-col">
                        <span class="text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Analysis Engine</span>
                        <span class="text-xs font-mono text-white">{entry.data.analysis_engine}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Consensus Score</span>
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-mono text-primary-accent">{entry.data.consensus_score}%</span>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Data Points Integrated</span>
                        <span class="text-xs font-mono text-white">{entry.data.source_urls.length} Sources</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Article Content -->
        <article class="max-w-4xl mx-auto px-6 py-12 prose prose-invert prose-primary-accent 
            prose-h2:text-white prose-h2:uppercase prose-h2:tracking-wider prose-h2:text-xl prose-h2:border-l-4 prose-h2:border-primary-accent prose-h2:pl-4 prose-h2:py-1
            prose-p:text-neutral-400 prose-p:leading-relaxed prose-p:text-lg
            prose-li:text-neutral-400 prose-strong:text-white
        ">
            <Content />
        </article>

        <!-- Sources Footer -->
        <div class="max-w-4xl mx-auto px-6 mt-12 border-t border-neutral-800 pt-12">
            <h3 class="text-xs font-black text-white uppercase tracking-widest mb-6">Verification Sources</h3>
            <ul class="space-y-3">
                {entry.data.source_urls.map((url) => (
                    <li class="text-sm font-mono text-neutral-500">
                        <span class="text-primary-accent">●</span> {url}
                    </li>
                ))}
            </ul>
        </div>

        <!-- Related Intelligence -->
        <div class="max-w-4xl mx-auto px-6">
            <RelatedArticles 
                currentSlug={entry.slug}
                tags={entry.data.tags || []}
                sector={entry.data.sector}
                collection="intelligence"
            />
        </div>

    </main>
</Layout>

