---
// SSR: Renders on-demand so new briefings appear instantly
export const prerender = false;

import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const briefings = (await getCollection('intelligence'))
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const severityColors = {
    Critical: 'bg-red-600 text-white',
    High: 'bg-orange-600 text-white',
    Medium: 'bg-yellow-600 text-black',
    Low: 'bg-blue-600 text-white'
};
---

<Layout title="Strategic Intelligence Briefings | SPS" description="AI-synthesized security intelligence based on consensus from Gemini, Claude, and GPT-4. Connect the dots on emerging threats in India.">
    <main class="bg-neutral-950 min-h-screen text-neutral-300 font-sans pb-20">
        
        <!-- Header -->
        <div class="border-b border-neutral-800 bg-neutral-900 pt-32 pb-12 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center gap-3 mb-4 flex-wrap">
                    <span class="bg-primary-accent/20 text-primary-accent border border-primary-accent/50 text-[10px] font-black px-2 py-1 rounded tracking-[0.2em] uppercase">Autonomous Intelligence Engine</span>
                    <span class="text-neutral-500 text-sm font-mono">/ INTELLIGENCE / STRATEGIC-BRIEFINGS</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-black text-white tracking-tight mb-4 uppercase italic">
                    Strategic <span class="text-primary-accent">Briefings</span>
                </h1>
                <p class="text-lg text-neutral-400 max-w-3xl">
                    High-fidelity synthesis of global signals and Indian regulatory frameworks. 
                    <strong class="text-white">Consensus-driven. DOTS-connected.</strong>
                </p>
            </div>
        </div>

        <!-- Briefings Grid -->
        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                {briefings.map((brief) => (
                    <a href={`/intelligence/briefings/${brief.slug}`} class="group block bg-neutral-900 border border-neutral-800 hover:border-primary-accent transition-all p-8 rounded-lg relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4">
                            <span class={`text-[10px] font-black px-2 py-1 rounded uppercase tracking-widest ${severityColors[brief.data.severity]}`}>
                                {brief.data.severity}
                            </span>
                        </div>
                        
                        <div class="flex items-center gap-4 mb-6">
                            <div class="text-[10px] font-mono text-neutral-500 uppercase tracking-widest">
                                {brief.data.pubDate.toLocaleDateString('en-IN', { day: '2-digit', month: 'long', year: 'numeric' })}
                            </div>
                            <div class="w-1 h-1 bg-neutral-700 rounded-full"></div>
                            <div class="text-[10px] font-mono text-primary-accent uppercase tracking-widest">
                                {brief.data.sector}
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-white group-hover:text-primary-accent transition-colors mb-4 leading-tight">
                            {brief.data.title}
                        </h2>

                        <div class="flex items-center gap-6 mt-8 pt-6 border-t border-neutral-800">
                            <div class="flex flex-col">
                                <span class="text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Consensus Score</span>
                                <div class="flex items-center gap-2">
                                    <div class="w-24 h-1 bg-neutral-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-primary-accent" style={`width: ${brief.data.consensus_score}%`}></div>
                                    </div>
                                    <span class="text-xs font-mono text-white">{brief.data.consensus_score}%</span>
                                </div>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Analysis Engine</span>
                                <span class="text-xs font-mono text-neutral-400">{brief.data.analysis_engine}</span>
                            </div>
                        </div>
                    </a>
                ))}
            </div>
        </div>

        <!-- Methodology Panel -->
        <div class="max-w-7xl mx-auto px-6 mt-12">
            <div class="bg-neutral-900 border border-neutral-800 p-8 rounded-lg">
                <h3 class="text-xs font-black text-white uppercase tracking-[0.3em] mb-6 flex items-center gap-3">
                    <span class="w-2 h-2 bg-primary-accent animate-pulse rounded-full"></span>
                    Consensus Protocol v1.0
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                        <div class="text-primary-accent font-mono text-sm mb-2">01. THE ANALYST (Gemini)</div>
                        <p class="text-xs text-neutral-500 leading-relaxed">
                            Identifies immediate operational impact and connects the event to broader regional trends.
                        </p>
                    </div>
                    <div>
                        <div class="text-primary-accent font-mono text-sm mb-2">02. THE RED TEAM (Claude)</div>
                        <p class="text-xs text-neutral-500 leading-relaxed">
                            Challenges assumptions, validates against Indian Law (PSARA, DPDP), and identifies compliance gaps.
                        </p>
                    </div>
                    <div>
                        <div class="text-primary-accent font-mono text-sm mb-2">03. THE STRATEGIST (GPT-4)</div>
                        <p class="text-xs text-neutral-500 leading-relaxed">
                            Synthesizes conflicting viewpoints into high-fidelity executive recommendations.
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </main>
</Layout>
