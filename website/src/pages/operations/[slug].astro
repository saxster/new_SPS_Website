---
import Layout from '../../layouts/Layout.astro';
import SideDrawer from '../../components/SideDrawer.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const cases = await getCollection('casestudies');
  return cases.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout 
  title={`${entry.data.title} | Operations Log`} 
  description={entry.data.summary}
  type="Article"
>
  <SideDrawer />

  <section class="brutalist-section pt-32 pb-20">
    <div class="brutalist-container pl-20">
      
      <!-- Header -->
      <div class="mb-12 border-b border-neutral-800 pb-12">
        <a href="/operations" class="text-xs font-mono text-neutral-500 hover:text-primary-accent mb-6 block">
          ← BACK TO LOGS
        </a>
        <h1 class="text-heading-1 text-white mb-6">{entry.data.title}</h1>
        <div class="flex flex-wrap gap-6 text-sm font-mono text-neutral-400">
          <span>// LOC: {entry.data.location.toUpperCase()}</span>
          <span>// DATE: {entry.data.date.toUpperCase()}</span>
          <span class="text-primary-accent">// STATUS: RESOLVED</span>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
        <!-- Main Content -->
        <div class="lg:col-span-8 prose prose-lg prose-invert max-w-none
          prose-headings:font-black prose-headings:uppercase prose-headings:text-white
          prose-headings:tracking-tight prose-headings:border-b prose-headings:border-neutral-800
          prose-headings:pb-2 prose-headings:mb-4
          prose-h2:text-2xl prose-h2:mt-12 prose-h3:text-xl prose-h3:mt-8
          prose-p:text-neutral-300 prose-p:leading-relaxed prose-p:mb-4
          prose-a:text-primary-accent prose-a:no-underline hover:prose-a:underline
          prose-blockquote:border-l-4 prose-blockquote:border-primary-accent
          prose-blockquote:bg-neutral-900 prose-blockquote:p-4 prose-blockquote:text-white
          prose-blockquote:not-italic prose-blockquote:my-6
          prose-li:text-neutral-300 prose-strong:text-white
          prose-code:bg-neutral-800 prose-code:text-primary-accent prose-code:px-1.5
          prose-code:py-0.5 prose-code:rounded prose-code:font-mono prose-code:text-sm
          prose-code:before:content-none prose-code:after:content-none
          prose-pre:bg-neutral-900 prose-pre:border prose-pre:border-neutral-800
          prose-pre:rounded-none prose-pre:p-4 prose-pre:overflow-x-auto
          prose-table:border-collapse prose-table:w-full prose-table:my-6
          prose-th:bg-neutral-900 prose-th:text-white prose-th:font-black prose-th:uppercase
          prose-th:text-left prose-th:p-3 prose-th:border prose-th:border-neutral-700
          prose-td:p-3 prose-td:border prose-td:border-neutral-800 prose-td:text-neutral-300
          prose-tr:even:bg-neutral-900/50
          prose-img:border-2 prose-img:border-neutral-800 prose-img:my-8 prose-img:mx-auto
          prose-figure:my-8 prose-figcaption:text-center prose-figcaption:text-neutral-500
          prose-figcaption:text-sm prose-figcaption:mt-2
          prose-hr:border-neutral-800 prose-hr:border-t-2 prose-hr:my-12
          prose-ul:my-4 prose-ul:pl-6 prose-ol:my-4 prose-ol:pl-6
          prose-li:my-1 prose-li:marker:text-primary-accent
        ">
          <Content />
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-4 space-y-8">
          <div class="brutalist-card bg-neutral-900">
            <h3 class="text-sm font-bold text-white uppercase tracking-widest mb-4">Mission Stats</h3>
            <ul class="space-y-4">
              {entry.data.outcome.map(o => (
                <li class="flex items-start gap-3 text-sm text-neutral-400">
                  <span class="text-success">✓</span>
                  {o}
                </li>
              ))}
            </ul>
          </div>

          <div class="brutalist-card bg-neutral-900 border-l-4 border-l-critical">
            <h3 class="text-sm font-bold text-white uppercase tracking-widest mb-4">Threat Tags</h3>
            <div class="flex flex-wrap gap-2">
              {entry.data.tags.map(tag => (
                <span class="px-2 py-1 bg-black border border-neutral-800 text-xs text-neutral-300 font-mono">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>
</Layout>
